\documentclass[crop,tikz,convert={outext=.svg,command=\unexpanded{pdf2svg \infile\space\outfile}},multi=false]{standalone}
\input{../../style.tex}
\begin{document}
	\def\distanceScale{2.3}
	\def\distance{\defaultDistanceNormal*\distanceScale}
	\def\halfCircleHeight{1.1*\distance}
	\def\pointSize{1pt*\distanceScale}
	\def\gradientAngleA{-5}
	\def\gradientAngleAinB{-40}
	\def\gradientAngleB{-115}
	\def\tangentSpaceAngleA{-19}
	\def\tangentSpaceAngleAOrth{-130}
	\def\tangentSpaceAngleB{-60}
	\def\tangentSpaceAngleBOrth{-140}
	\def\gradientLengthA{20pt*\distanceScale}
	\def\gradientLengthAinB{17pt*\distanceScale}
	\def\gradientLengthB{13pt*\distanceScale}
	\def\tangentSpaceLength{40pt*\distanceScale*1.1}
	\def\tangentSpaceLengthOrth{26pt*\distanceScale*1.1}
	\def\UkPosX{0.75*\distance}
	\def\UkPosY{0.65*\halfCircleHeight}
	\def\UkpPosX{1.24*\distance}
	\def\UkpPosY{0.65*\halfCircleHeight-0.25*\distance}
	\definecolor{colorA}{rgb}{0.0, 0.6, 0.0}
	\definecolor{colorB}{rgb}{0.9, 0.0, 0.0}
	\definecolor{retractionColor}{rgb}{0.5, 0.5, 0.5}
	\def\equationDistance{1.0*\defaultDistanceEquations}
	\def\xOffsetSecondPicture{1.8*\distance+\equationDistance}
	\begin{tikzpicture}
		% First diagram
		\draw[thick] (0, 0) to [out=25, in=-130] (0.4*\distance, 0.25*\distance) to[out=50, in=-180] ++(0.5*\distance, 0.3*\distance);
		\draw[thick, fill=white] (0, 0) to[out=90, in=180] (\distance/2, \halfCircleHeight/2) to [out=0, in=90] (\distance, 0)
			to[out=30, in=-120] (1.5*\distance, 0.3*\distance) to[out=60, in=-200] (1.8*\distance, 0.5*\distance)
			to[out=100, in=0] (1.3*\distance, 0.5*\distance+1.2*\halfCircleHeight/2)
			to[out=180, in=45] ++(-0.35*\distance, -0.15*\distance) to[out=-120, in=20] (0.55*\distance, 0.7*\distance) to[out=-160, in=90] (0, 0);
		
		\node[circle, minimum size=\pointSize, fill=black, outer sep=0, inner sep=0] (Uk) at (\UkPosX, \UkPosY) {};
		\node[circle, minimum size=\pointSize, fill=black, outer sep=0, inner sep=0] (Ukp) at (\UkpPosX, \UkpPosY) {};
		
		\draw[thick, retractionColor, -latex] (Uk) to[out=\gradientAngleA, in=130] ++(0.18*\distance, -0.08*\distance) to[out=-50, in=180] ++(0.16*\distance, -0.13*\distance) to[out=0, in=150] ++(0.15*\distance, -0.04*\distance);
		
		\draw[thick, -latex, colorA] (Uk) -- ++({cos(\gradientAngleA)*\gradientLengthA}, {sin(\gradientAngleA)*\gradientLengthA});
		\draw[thick, colorA] ({\UkPosX+cos(\tangentSpaceAngleA)*\tangentSpaceLength/2}, {\UkPosY+sin(\tangentSpaceAngleA)*\tangentSpaceLength/2}) --
		++({cos(\tangentSpaceAngleAOrth)*\tangentSpaceLengthOrth/2}, {sin(\tangentSpaceAngleAOrth)*\tangentSpaceLengthOrth/2}) --
		++({-cos(\tangentSpaceAngleA)*\tangentSpaceLength}, {-sin(\tangentSpaceAngleA)*\tangentSpaceLength}) --
		++({-cos(\tangentSpaceAngleAOrth)*\tangentSpaceLengthOrth}, {-sin(\tangentSpaceAngleAOrth)*\tangentSpaceLengthOrth}) --
		++({cos(\tangentSpaceAngleA)*\tangentSpaceLength}, {sin(\tangentSpaceAngleA)*\tangentSpaceLength}) -- cycle;
		
		\node[color=colorA] () at (0.57*\distance, 0.93*\distance) {$T_{U_k}\Stiefel$};
		\node[color=colorA] () at (1.25*\distance, 0.75*\distance) {$\xi_k$};
		
		\node[] () at (\UkPosX-0.07*\distance, \UkPosY-0.07*\distance) {$U_k$};
		\node[] () at (\UkpPosX+0.1*\distance, \UkpPosY-0.1*\distance) {$U_{k+1}$};
		
		\node[color=retractionColor] () at (0.94*\distance, 0.46*\distance) {$R_\xi(\alpha)$};
		
		\node[] () at (1.95*\distance, 1.05*\distance) {$\Stiefel$};
		
		% Second diagram
		\draw[thick] (\xOffsetSecondPicture, 0) to [out=25, in=-130] (\xOffsetSecondPicture+0.4*\distance, 0.25*\distance) to[out=50, in=-180] ++(0.5*\distance, 0.3*\distance);
		\draw[thick, fill=white] (\xOffsetSecondPicture, 0) to[out=90, in=180] (\xOffsetSecondPicture+\distance/2, \halfCircleHeight/2) to [out=0, in=90] (\xOffsetSecondPicture+\distance, 0)
		to[out=30, in=-120] (\xOffsetSecondPicture+1.5*\distance, 0.3*\distance) to[out=60, in=-200] (\xOffsetSecondPicture+1.8*\distance, 0.5*\distance)
		to[out=100, in=0] (\xOffsetSecondPicture+1.3*\distance, 0.5*\distance+1.2*\halfCircleHeight/2)
		to[out=180, in=45] ++(-0.35*\distance, -0.15*\distance) to[out=-120, in=20] (\xOffsetSecondPicture+0.55*\distance, 0.7*\distance) to[out=-160, in=90] (\xOffsetSecondPicture, 0);
		
		\node[circle, minimum size=\pointSize, fill=black, outer sep=0, inner sep=0] (Ukp) at (\xOffsetSecondPicture+\UkpPosX, \UkpPosY) {};
		\node[] () at (\xOffsetSecondPicture+\UkpPosX+0.1*\distance, \UkpPosY+0.07*\distance) {$U_{k+1}$};
		
		\draw[thick, colorB] ({\xOffsetSecondPicture+\UkpPosX+cos(\tangentSpaceAngleB)*\tangentSpaceLength/2}, {\UkpPosY+sin(\tangentSpaceAngleB)*\tangentSpaceLength/2}) --
		++({cos(\tangentSpaceAngleBOrth)*\tangentSpaceLengthOrth/2}, {sin(\tangentSpaceAngleBOrth)*\tangentSpaceLengthOrth/2}) --
		++({-cos(\tangentSpaceAngleB)*\tangentSpaceLength}, {-sin(\tangentSpaceAngleB)*\tangentSpaceLength}) --
		++({-cos(\tangentSpaceAngleBOrth)*\tangentSpaceLengthOrth}, {-sin(\tangentSpaceAngleBOrth)*\tangentSpaceLengthOrth}) --
		++({cos(\tangentSpaceAngleB)*\tangentSpaceLength}, {sin(\tangentSpaceAngleB)*\tangentSpaceLength}) -- cycle;
		\draw[thick, -latex, colorB] (Ukp) -- ++({cos(\gradientAngleB)*\gradientLengthB}, {sin(\gradientAngleB)*\gradientLengthB});
		\draw[thick, -latex, colorA] (Ukp) -- ++({cos(\gradientAngleAinB)*\gradientLengthAinB}, {sin(\gradientAngleAinB)*\gradientLengthAinB});
		
		\node[color=colorB] () at (\xOffsetSecondPicture+1.15*\distance, 0.71*\distance) {$T_{U_{k+1}}\Stiefel$};
		\node[color=colorB] () at (\xOffsetSecondPicture+1.05*\distance, 0.36*\distance) {$\xi_{k+1}$};
		\node[color=colorA] () at (\xOffsetSecondPicture+1.5*\distance, -0.0*\distance) {$T_{k\rightarrow k+1}(\xi_k)$};
		
		\node[] () at (\xOffsetSecondPicture-\equationDistance/2+0.12*\distance, 0.5*\distance/2+1.2*\halfCircleHeight/2/2) {$\rightarrow$};
	\end{tikzpicture}
\end{document}