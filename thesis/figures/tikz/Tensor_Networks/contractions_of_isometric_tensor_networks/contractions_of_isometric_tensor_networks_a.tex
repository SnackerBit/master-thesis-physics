\documentclass[crop, tikz]{standalone}
\input{../../style.tex}
\usepackage{tikz-network}

\begin{document}
	\def\openLegLength{23 pt}
	
	\def\tensorDistance{1.0*\defaultDistanceNormal}
	
	\def\posXA{0}
	\def\posYA{0}
	\def\posXB{\tensorDistance*0.8}
	\def\posYB{\tensorDistance*0.3}
	\def\posXC{\tensorDistance*0.5}
	\def\posYC{-\tensorDistance*0.4}
	\def\posXD{\tensorDistance*1.2}
	\def\posYD{-\tensorDistance*0.5}
	\def\posXE{\tensorDistance*1.8}
	\def\posYE{-\tensorDistance*0.45}
	\def\posXF{\tensorDistance*1.5}
	\def\posYF{\tensorDistance*0.4}
	\def\posXG{\tensorDistance*2.3}
	\def\posYG{-\tensorDistance*0.1}
	\def\posXH{\tensorDistance*2.2}
	\def\posYH{-\tensorDistance*0.8}
	\def\posXI{\tensorDistance*2.9}
	\def\posYI{-\tensorDistance*0.2}
	\def\posXJ{\tensorDistance*3.1}
	\def\posYJ{\tensorDistance*0.4}
	
	\def\angleA{170}
	\def\angleC{-120}
	\def\angleF{35}
	\def\angleH{-45}
	\def\angleI{-10}
	\def\angleJ{20}
	
	\begin{tikzpicture}
		% Draw tensors
		\node[tensorPhysical, minimum size=\smallTensorWidth] (A) at (\posXA, \posYA) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (B) at (\posXB, \posYB) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (C) at (\posXC, \posYC) {};
		\node[tensorOrthoCenter, minimum size=\smallTensorWidth] (D) at (\posXD, \posYD) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth, fill=redMarkingColor] (E) at (\posXE, \posYE) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (F) at (\posXF, \posYF) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (G) at (\posXG, \posYG) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (H) at (\posXH, \posYH) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (I) at (\posXI, \posYI) {};
		\node[tensorPhysical, minimum size=\smallTensorWidth] (J) at (\posXJ, \posYJ) {};
		
		\begin{pgfonlayer}{bg}
			% Draw subregion M
			\fill[fill=redMarkingColor, opacity=\backgroundopacity] \convexhull{D, E}{\smallTensorWidth*0.9};
			\node[color=redMarkingColor] (M) at (\posXD-\tensorDistance*0.2, \posYD-\tensorDistance*0.4) {$\mathcal{M}$};
			
			% Draw connecting legs
			\draw[virtualLeg] (A) -- (B);
			\draw[virtualLeg] (B) -- (F);
			\draw[virtualLeg] (C) -- (B);
			\draw[virtualLeg] (C) -- (D);
			\draw[virtualLeg] (E) -- (D);
			\draw[virtualLeg] (F) -- (G);
			\draw[virtualLeg] (F) -- (E);
			\draw[virtualLeg] (G) -- (H);
			\draw[virtualLeg] (H) -- (E);
			\draw[virtualLeg] (I) -- (J);
			\draw[virtualLeg] (I) -- (G);
			\draw[virtualLeg] (J) -- (G);
			
			\draw[virtualLeg] ({\posXA+\openLegLength*cos(\angleA)}, {\posYA+\openLegLength*sin(\angleA)}) -- (A);
			\draw[virtualLeg] ({\posXC+\openLegLength*cos(\angleC)}, {\posYC+\openLegLength*sin(\angleC)}) -- (C);
			\draw[virtualLeg] ({\posXF+\openLegLength*cos(\angleF)}, {\posYF+\openLegLength*sin(\angleF)}) -- (F);
			\draw[virtualLeg] ({\posXH+\openLegLength*cos(\angleH)}, {\posYH+\openLegLength*sin(\angleH)}) -- (H);
			\draw[virtualLeg] ({\posXI+\openLegLength*cos(\angleI)}, {\posYI+\openLegLength*sin(\angleI)}) -- (I);
			\draw[virtualLeg] ({\posXJ+\openLegLength*cos(\angleJ)}, {\posYJ+\openLegLength*sin(\angleJ)}) -- (J);
		\end{pgfonlayer}
	
		% Draw big blob
		\def\blobhalfwidth{\smallTensorWidth*2.0}
		\def\blobhalfheight{\smallTensorWidth*1.1}
		\def\blobPosX{-2*\openLegLength-\defaultDistanceEquations-\blobhalfwidth}
		\def\blobPosY{-\smallTensorWidth/2}
		\node[draw, ellipse, minimum width=2*\blobhalfwidth, minimum height=\blobhalfheight*2, line width=\defaultLineWidth, draw=borderColor, fill=generalTensorColor,outer sep=0] (blob) at (\blobPosX, \blobPosY) {$\mathcal{N}$};
		\begin{pgfonlayer}{bg}
			% Draw legs
			\draw[virtualLeg] ({\blobPosX + (\blobhalfwidth+\openLegLength)*cos(\angleA)}, {\blobPosY + (\blobhalfheight+\openLegLength)*sin(\angleA)}) -- (blob);
			\draw[virtualLeg] ({\blobPosX + (\blobhalfwidth+\openLegLength)*cos(\angleC)}, {\blobPosY + (\blobhalfheight+\openLegLength)*sin(\angleC)}) -- (blob);
			\draw[virtualLeg] ({\blobPosX + (\blobhalfwidth+\openLegLength)*cos(\angleF)}, {\blobPosY + (\blobhalfheight+\openLegLength)*sin(\angleF)}) -- (blob);
			\draw[virtualLeg] ({\blobPosX + (\blobhalfwidth+\openLegLength)*cos(\angleH)}, {\blobPosY + (\blobhalfheight+\openLegLength)*sin(\angleH)}) -- (blob);
			\draw[virtualLeg] ({\blobPosX + (\blobhalfwidth+\openLegLength)*cos(\angleI)}, {\blobPosY + (\blobhalfheight+\openLegLength)*sin(\angleI)}) -- (blob);
			\draw[virtualLeg] ({\blobPosX + (\blobhalfwidth+\openLegLength)*cos(\angleJ)}, {\blobPosY + (\blobhalfheight+\openLegLength)*sin(\angleJ)}) -- (blob);
		\end{pgfonlayer}

		% draw equal sign
		\node[] () at (-\openLegLength-\defaultDistanceEquations/2, \blobPosY) {$=$};
	\end{tikzpicture}
\end{document}